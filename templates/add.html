<!DOCTYPE html>
<html>
<head>
    <title>Add Sighting</title>
    <link rel="stylesheet" href="/static/style/style.css">

    <style>
        #map {
            height: 400px;
            margin-top: 20px;
        }
    </style>

</head>
<body>
    <h1>Add New Sighting</h1>
    <form method="POST" action="/add">
        <!-- Animal Dropdown -->
        <label for="animal">Animal:</label> <!-- add the for="animal" -->
            <select name="animal" required>
                <option value="" disabled selected>Select animal</option>

                <!-- Game Animal Type Dropdown -->
                <optgroup label="Big Game">
                    <option value="American Bison">American Bison</option>
                    <option value="Black Bear">Black Bear</option>
                    <option value="Brown Bear">Brown Bear</option>
                    <option value="Caribou">Caribou</option>
                    <option value="Cougar">Cougar</option>
                    <option value="Elk">Elk</option>
                    <option value="Moose">Moose</option>
                    <option value="Mule Deer">Mule Deer</option>
                    <option value="Pronghorn">Pronghorn</option>
                    <option value="Whitetail Deer(Buck)">Whitetail Deer(Buck)</option>
                    <option value="Whitetail Deer(Doe)">Whitetail Deer(Doe)</option>
                    <option value="Whitetail Deer(Button Buck)">Whitetail Deer(Button Buck)</option>
                    <option value="Wild Boar">Wild Boar</option>
                </optgroup>



                <optgroup label="Small Game">
                    <option value="Beaver">Beaver</option>
                    <option value="Cottontail">Cottontail</option>
                    <option value="Crow">Crow</option>
                    <option value="Groundhog">Groundhog</option>
                    <option value="Opossum">Opossum</option>
                    <option value="Porcupine">Porcupine</option>
                    <option value="Rabbit">Rabbit</option>
                    <option value="Raccoon">Raccoon</option>
                    <option value="Squirrel">Squirrel</option>

                </optgroup>

                <optgroup label="Upland Birds">
                    <option value="Bobwhite Quail">Bobwhite Quail</option>
                    <option value="Chukar Partridge">Chukar Partridge</option>
                    <option value="Grouse(Ruffed, Sage, Spruce, Sharp-Tailed)">Grouse (Ruffed, Sage, Spruce, Sharp-Tailed)</option>
                    <option value="Hungarian Partridge">Hungarian Partridge</option>
                    <option value="Pheasant">Pheasant</option>
                    <option value="Ptarmigan">Ptarmigan</option>
                    <option value="Turkey">Turkey</option>
                    <option value="Woodcock">Woodcock</option>
                </optgroup>

                <optgroup label="Waterfowl">
                    <option value="Duck">Duck</option>
                    <option value="Goose">Goose</option>
                    <option value="Brant">Brant</option>
                    <option value="Mergansers">Mergansers</option>
                </optgroup>

                <optgroup label="Varmints & Predators">
                    <option value="Coyote">Coyote</option>
                    <option value="Fox">Fox</option>
                    <option value="Bobcat">Bobcat</option>
                    <option value="Nutria">Nutria</option>
                </optgroup>
            </select>
            <br>

        <!-- Date/Time Selection Box -->
        <label>Date/Time: <input type="datetime-local" name="date_time"></label><br>

        <!-- Weather Condition Dropdown + Optional Text -->
        <label>Weather:
            <select id="weather-select" name="weather" onchange="checkOther(this, 'weather-other')">
                <option value="" disabled selected>Select weather</option>
                <option value="Sunny">Sunny</option>
                <option value="Partly Cloudy">Partly Cloudy</option>
                <option value="Cloudy">Cloudy</option>
                <option value="Overcast">Overcast</option>
                <option value="Foggy">Foggy</option>
                <option value="Rain">Rain</option>
                <option value="Light Rain">Light Rain</option>
                <option value="Thunderstorms">Thunderstorms</option>
                <option value="Snow">Snow</option>
                <option value="Light Snow">Light Snow</option>
                <option value="Snowstorm">Snowstorm</option>
                <option value="Windy">Windy</option>
            </select>
            </label>
            <input type="text" id="weather-other" name="weather_other" placeholder="Enter weather" style="display:none;">
            <br>

        <!-- Wind Type Dropdown + Optional Text -->
        <label>Wind Type:
            <select id="wind-select" name="wind" onchange="checkOther(this, 'wind-other')">
                <option value="" disabled selected>Select wind</option>
                <option value="Calm">Calm</option>
                <option value="Light Breeze">Light Breeze</option>
                <option value="Breezy">Breezy</option>
                <option value="Windy">Windy</option>
                <option value="Gusty">Gusty</option>
                <option value="Strong Wind">Strong Wind</option>
                <option value="Other">Other</option>
            </select>
        </label>
        <input type="text" id="wind-other" name="wind_other" placeholder="Enter wind description" style="display:none;">
        <br>

        <!-- Wind Speed Dropdown -->
        <label>Wind Speed (mph):
            <select name="wind_speed">
                <option value="" disabled selected>Select wind speed</option>
                {% for i in range(0, 55, 5) %}
                <option value="{{ i }}">{{ i }} mph</option>
                {% endfor %}
                <option value="55+">55+ mph</option>
            </select>
        </label>
            <br>

        <!-- Wind Direction Dropdown -->
            <label>Wind Direction:
                <select name="wind_direction">
                    <option value="" disabled selected>Select wind direction</option>
                    <option value="N">North</option>
                    <option value="NE">Northeast</option>
                    <option value="E">East</option>
                    <option value="SE">Southeast</option>
                    <option value="South">South</option>
                    <option value="SW">Southwest</option>
                    <option value="W">West</option>
                    <option value="NW">Northwest</option>
                    <option value="Variable">Variable</option>
                </select>
            </label>
            <br>

            <!-- Dropdown for Humidity -->
            <label>Humidity (%):
            <select name="humidity">
                <option value="" disabled selected>Select humidity</option>
                {% for i in range(0, 105, 5) %}
                    <option value="{{ i }}">{{ i }}%</option>
                {% endfor %}
            </select>
            </label>
            <br>

        <!-- Location Text Field -->
            <!-- will be replaced or auto filled with map later
        <label>Location: <input type="text" name="location"></label><br> -->

        <!-- Notes Text Field -->
        <label>Notes: <textarea name="notes"></textarea></label><br>

        <!-- Select color for sighting on map in Add New Sighting page -->
        <label>Select a color to represent the sighting on the map:</label><br>
<button type="button" onclick="openColorDialog()">Choose Color</button>
<input type="hidden" name="marker_color" id="marker_color" value="#2e7d32">
<div id="color-list" style="display: none; border: 1px solid #ccc; padding: 10px; margin-top: 5px; max-width: 200px;">
    <div onclick="selectColor('#f44336')" style="background:#f44336;color:white;padding:5px;margin:2px;cursor:pointer;">Red</div>
    <div onclick="selectColor('#e91e63')" style="background:#e91e63;color:white;padding:5px;margin:2px;cursor:pointer;">Pink</div>
    <div onclick="selectColor('#9c27b0')" style="background:#9c27b0;color:white;padding:5px;margin:2px;cursor:pointer;">Purple</div>
    <div onclick="selectColor('#673ab7')" style="background:#673ab7;color:white;padding:5px;margin:2px;cursor:pointer;">Deep Purple</div>
    <div onclick="selectColor('#3f51b5')" style="background:#3f51b5;color:white;padding:5px;margin:2px;cursor:pointer;">Indigo</div>
    <div onclick="selectColor('#2196f3')" style="background:#2196f3;color:white;padding:5px;margin:2px;cursor:pointer;">Blue</div>
    <div onclick="selectColor('#03a9f4')" style="background:#03a9f4;color:black;padding:5px;margin:2px;cursor:pointer;">Light Blue</div>
    <div onclick="selectColor('#00bcd4')" style="background:#00bcd4;color:black;padding:5px;margin:2px;cursor:pointer;">Cyan</div>
    <div onclick="selectColor('#009688')" style="background:#009688;color:white;padding:5px;margin:2px;cursor:pointer;">Teal</div>
    <div onclick="selectColor('#4caf50')" style="background:#4caf50;color:white;padding:5px;margin:2px;cursor:pointer;">Green</div>
    <div onclick="selectColor('#8bc34a')" style="background:#8bc34a;color:black;padding:5px;margin:2px;cursor:pointer;">Light Green</div>
    <div onclick="selectColor('#cddc39')" style="background:#cddc39;color:black;padding:5px;margin:2px;cursor:pointer;">Lime</div>
    <div onclick="selectColor('#ffeb3b')" style="background:#ffeb3b;color:black;padding:5px;margin:2px;cursor:pointer;">Yellow</div>
    <div onclick="selectColor('#ffc107')" style="background:#ffc107;color:black;padding:5px;margin:2px;cursor:pointer;">Amber</div>
    <div onclick="selectColor('#ff9800')" style="background:#ff9800;color:white;padding:5px;margin:2px;cursor:pointer;">Orange</div>
    <div onclick="selectColor('#ff5722')" style="background:#ff5722;color:white;padding:5px;margin:2px;cursor:pointer;">Deep Orange</div>
    <div onclick="selectColor('#795548')" style="background:#795548;color:white;padding:5px;margin:2px;cursor:pointer;">Brown</div>
    <div onclick="selectColor('#9e9e9e')" style="background:#9e9e9e;color:black;padding:5px;margin:2px;cursor:pointer;">Gray</div>
    <div onclick="selectColor('#607d8b')" style="background:#607d8b;color:white;padding:5px;margin:2px;cursor:pointer;">Blue Gray</div>
    <div onclick="selectColor('#000000')" style="background:#000000;color:white;padding:5px;margin:2px;cursor:pointer;">Black</div>
</div>
<span id="selected-color" style="display: inline-block; width: 20px; height: 20px; background-color: #2e7d32; vertical-align: middle; border: 1px solid #000;"></span>

<script>
    function openColorDialog() {
        const colorList = document.getElementById("color-list");
        colorList.style.display = colorList.style.display == "none" ? "block" : "none";
    }

    function selectColor(colorCode) {
        document.getElementById("marker_color").value = colorCode;
        document.getElementById("selected-color").style.backgroundColor = colorCode;
        document.getElementById("color-list").style.display = "none";
    }
</script>
        <br>

        <!-- Autocomplete map search | GPS | Map UI -->
        <label>Location:
            <input id="autocomplete" type="text" name="location" placeholder="Start typing or use GPS" size="50">
        </label>
        <button type="button" onclick="getCurrentLocation()">üìç Use My Location</button>
        <input type="hidden" name="lat" id="lat">
        <input type="hidden" name="lng" id="lng">
        <div id="map"></div>

        <!-- Submit button -->
        <button type="submit">Save</button>
        <br>

        {{ form.hidden_tag() }}

    </form>

    <!-- Back link -->
    <a href="/">Back</a>

    <!-- JS for showing other fields -->
    <script>
        function checkOther(selectElem, otherInputId) {
            const otherInput = document.getElementById(otherInputId);
            if (selectElem.value == "Other") {
            otherInput.style.display = "inline-block";
            otherInput.required = true;
        } else {
            otherInput.style.display = "none";
            otherInput.required = false;
        }
    }
    </script>

    <!-- Google Mpas + Autocomplete + GPS Location -->
    <script>
        let map;
        let marker;

        function initMap() {
            const defaultLatLng = { lat: 45.0, lng: -93.0 }; // Default to Minnesota - CHANGE FOR USER ACCOUNT PREFERENCE LATER

            map = new google.maps.Map(document.getElementById("map"), {
                center: defaultLatLng,
                zoom: 7,
            });

        marker = new google.maps.Marker({
            map: map,
            position: defaultLatLng,
            draggable: true
        });

        // Update hidden fields when marker is moved
        google.maps.event.addListener(marker, 'dragend', function () {
            const pos = marker.getPosition();
            document.getElementById("lat").value = pos.lat();
            document.getElementById("lng").value = pos.lng();
        });

        // Autocomplete input
        const input = document.getElementById("autocomplete");
        const autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.bindTo("bounds", map);

        autocomplete.addListener("place_changed", () => {
            const place = autocomplete.getPlace();
            if (!place.geometry) return;

            map.setCenter(place.geometry.location);
            map.setZoom(13);

            marker.setPosition(place.geometry.location);
            document.getElementById("lat").value = place.geometry.location.lat();
            document.getElementById("lng").value = place.geometry.location.lng();
        });
    }

    function getCurrentLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const pos = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude,
                    };
                    map.setCenter(pos);
                    map.setZoom(13);
                    marker.setPosition(pos);
                    document.getElementById("lat").value = pos.lat;
                    document.getElementById("lng").value = pos.lng;

                    // Optionally reverse geocode and fill input
                    const geocoder = new google.maps.Geocoder();
                    geocoder.geocode({ location: pos }, (results, status) => {
                        if (status === "OK" && results[0]) {
                            document.getElementById("autocomplete").value = results[0].formatted.address;
                        }
                    });
                },
                () => {
                    alert("Unable to retrieve your location.");
                }
            );
        } else {
            alert("Geolocation is not supported by your browser.");
        }
     }
  </script>

    <!-- need actual google maps api -->
  <!-- Load Google Maps & Places JS -->
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY_HERE&libraries=places&callback=initMap" async defer></script>

</body>
</html>