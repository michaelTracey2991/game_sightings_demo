<!--
view_harvest.html
Displays a single harvest in detail, with edit/delete buttons,
photo zoom, and a mini map
-->
<!DOCTYPE html>
<html>
<head>
    <title>View Harvest</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        .modal {
            display: none;
            position: fixed;
            z-index: 9999;
            left: 0; top: 0;
            width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.6);
        }
        .modal-content {
            margin: 10% auto;
            background-color: #fff;
            padding: 20px;
            max-width: 500px;
            border-radius: 5px;
        }
        .modal-content img {
            width: 100%;
            height: auto;
        }
        .close {
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        /* Buttons and layout */
        .btn {
            width: 100%;
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            text-align: center;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }
        .btn:hover {
            background-color: #388E3C;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            width: 160px;
            gap: 10px;
        }
        .action-buttons button,
        .action-buttons form button {
            padding: 10px;
            font-size: 1em;
            width: 100%;
        }

        .flex-view {
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        table.details-table {
            flex: 1;
            width: 60%;
        }

        #harvestMap {
            flex: 1;
            height: 400px;
        }
    </style>
</head>
<body>
<p><a href="{{ url_for('view_harvests') }}">‚Üê Back to All Sightings</a></p>
    <h1>{{ harvest.animal }} Harvest Details</h1>

    <div style="margin-bottom: 1em;">
        <div class="action-buttons">
            <form action="{{ url_for('edit_harvest', harvest_id=harvest.id) }}">
                <button type="submit">Edit</button>
            </form>
            <button type="button" onclick="openDeleteModal('{{ url_for('delete_harvest', harvest_id=harvest.id) }}')">Delete</button>
        </div>

    </div>

    <div class="flex-view">
        <table border="1" class="details-table">
            <tr><th>Animal</th><td>{{ harvest.animal }}</td></tr>
            <tr><th>Date/Time</th><td>{{ harvest.date_time }}</td></tr>
            <tr><th>Weapon</th><td>{{ harvest.weapon }}</td></tr>
            <tr><th>Caliber</th><td>{{ harvest.caliber or '-' }}</td></tr>
            <tr><th>Broadhead</th><td>{{ harvest.broadhead or '-' }}</td></tr>
            <tr><th>Weather</th><td>{{ harvest.weather or '-' }}</td></tr>
            <tr><th>Wind Speed</th><td>{{ harvest.wind_speed or '-' }}</td></tr>
            <tr><th>Wind Direction</th><td>{{ harvest.wind_direction or '-' }}</td></tr>
            <tr><th>Humidity</th><td>{{ harvest.humidity or '-' }}</td></tr>
            <tr><th>Distance Traveled</th><td>{{ harvest.distance_traveled or '-' }}</td></tr>
            <tr><th>Notes</th><td>{{ harvest.notes }}</td></tr>
            <tr><th>Location</th><td>{{ harvest.location }}</td></tr>
            <tr><th>Marker Color</th><td><div style="width: 20px; height: 20px; background-color: {{ harvest.marker_color }};"></div></td></tr>
        </table>

        <div id="harvestMap"></div>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const lat = parseFloat({{ harvest.lat or 'NaN' }});
            const lng = parseFloat({{ harvest.lng or 'NaN' }});

            if (!isNaN(lat) && !isNaN(lng)) {
                const map = L.map('harvestMap').setView([lat, lng], 13);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

                const markerColor = "{{ harvest.marker_color or '#2e7d32' }}";

                L.circleMarker([lat, lng], {
                    radius: 10,
                    fillColor: markerColor,
                    color: markerColor,
                    weight: 1,
                    fillOpacity: 0.9
                }).addTo(map).bindPopup("{{ harvest.animal }}");
            } else {
                document.getElementById('harvestMap').innerHTML = "<p>No coordinates available for this harvest.</p>";
            }
        });
    </script>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <h3>Are you sure you want to delete this harvest?</h3>
            <form id="deleteForm" method="POST">
                <button type="submit">Yes, Delete</button>
                <button type="button" onclick="closeDeleteModal()">Cancel</button>
            </form>
        </div>
    </div>

    <script>
        function openDeleteModal(actionUrl) {
            document.getElementById('deleteForm').action = actionUrl;
            document.getElementById('deleteModal').style.display = 'block';
        }
        function closeDeleteModal() {
            document.getElementById('deleteModal').style.display = 'none';
        }

        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                closeDeleteModal();
            }
        }
    </script>
</body>
</html>